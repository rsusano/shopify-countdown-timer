<script src="{{ 'countdown-timer.js' | asset_url }}" defer></script>

{%- liquid
  assign end_date = section.settings.end_date
  assign end_time = section.settings.end_time | default: '00:00'
  assign full_end_date = end_date | append: 'T' | append: end_time
-%}

<div
  class="countdown-timer-section color-{{ section.settings.color_scheme }} countdown-timer--layout-{{ section.settings.desktop_layout }} countdown-timer--mobile-layout-{{ section.settings.mobile_layout }}"
  style="
    --countdown-bg-color: {{ section.settings.background_color }};
    --countdown-text-color: {{ section.settings.text_color }};
    --countdown-accent-color: {{ section.settings.accent_color }};
    --countdown-timer-text-color: {{ section.settings.timer_text_color }};
    --countdown-timer-label-color: {{ section.settings.timer_label_color }};
    --countdown-separator-color: {{ section.settings.separator_color }};
    --countdown-heading-size: {{ section.settings.heading_size }}px;
    --countdown-subheading-size: {{ section.settings.subheading_size }}px;
    --countdown-timer-number-size: {{ section.settings.timer_number_size }}px;
    --countdown-timer-label-size: {{ section.settings.timer_label_size }}px;
    --countdown-timer-gap: {{ section.settings.timer_gap }}px;
    --countdown-content-gap: {{ section.settings.content_gap }}px;
    --countdown-heading-size-mobile: {{ section.settings.mobile_heading_size }}px;
    --countdown-subheading-size-mobile: {{ section.settings.mobile_subheading_size }}px;
    --countdown-timer-number-size-mobile: {{ section.settings.mobile_timer_number_size }}px;
    --countdown-timer-label-size-mobile: {{ section.settings.mobile_timer_label_size }}px;
    --countdown-timer-gap-mobile: {{ section.settings.mobile_timer_gap }}px;
    --countdown-content-gap-mobile: {{ section.settings.mobile_content_gap }}px;
    --countdown-padding-top: {{ section.settings.padding_top }}px;
    --countdown-padding-bottom: {{ section.settings.padding_bottom }}px;
    --countdown-padding-top-mobile: {{ section.settings.mobile_padding_top }}px;
    --countdown-padding-bottom-mobile: {{ section.settings.mobile_padding_bottom }}px;
  "
>
  <div class="countdown-timer__wrapper section section--{{ section.settings.section_width }}">
    <countdown-timer-component
      class="countdown-timer"
      data-end-date="{{ full_end_date }}"
      data-show-days="{{ section.settings.show_days }}"
      data-show-hours="{{ section.settings.show_hours }}"
      data-show-minutes="{{ section.settings.show_minutes }}"
      data-show-seconds="{{ section.settings.show_seconds }}"
      data-expired-message="{{ section.settings.expired_message }}"
      data-hide-when-expired="{{ section.settings.hide_when_expired }}"
      data-restart-enabled="{{ section.settings.restart_enabled }}"
      data-restart-days="{{ section.settings.restart_days }}"
      data-restart-hours="{{ section.settings.restart_hours }}"
      data-restart-minutes="{{ section.settings.restart_minutes }}"
      data-restart-seconds="{{ section.settings.restart_seconds }}"
    >
      <div class="countdown-timer__content">
        <div class="countdown-timer__text-content">
          {%- if section.settings.heading != blank -%}
            <h2 class="countdown-timer__heading">
              {{ section.settings.heading }}
            </h2>
          {%- endif -%}

          {%- if section.settings.subheading != blank -%}
            <p class="countdown-timer__subheading">
              {{ section.settings.subheading }}
            </p>
          {%- endif -%}
        </div>

        <div class="countdown-timer__timer">
          {%- if section.settings.show_days -%}
            <div class="countdown-timer__unit">
              <span class="countdown-timer__number" data-days>00</span>
              <span class="countdown-timer__label">{{ section.settings.days_label }}</span>
            </div>
            {%- if section.settings.show_separator and section.settings.show_hours -%}
              <span class="countdown-timer__separator">{{ section.settings.separator_style }}</span>
            {%- endif -%}
          {%- endif -%}

          {%- if section.settings.show_hours -%}
            <div class="countdown-timer__unit">
              <span class="countdown-timer__number" data-hours>00</span>
              <span class="countdown-timer__label">{{ section.settings.hours_label }}</span>
            </div>
            {%- if section.settings.show_separator and section.settings.show_minutes -%}
              <span class="countdown-timer__separator">{{ section.settings.separator_style }}</span>
            {%- endif -%}
          {%- endif -%}

          {%- if section.settings.show_minutes -%}
            <div class="countdown-timer__unit">
              <span class="countdown-timer__number" data-minutes>00</span>
              <span class="countdown-timer__label">{{ section.settings.minutes_label }}</span>
            </div>
            {%- if section.settings.show_separator and section.settings.show_seconds -%}
              <span class="countdown-timer__separator">{{ section.settings.separator_style }}</span>
            {%- endif -%}
          {%- endif -%}

          {%- if section.settings.show_seconds -%}
            <div class="countdown-timer__unit">
              <span class="countdown-timer__number" data-seconds>00</span>
              <span class="countdown-timer__label">{{ section.settings.seconds_label }}</span>
            </div>
          {%- endif -%}
        </div>

        {%- if section.settings.button_label != blank -%}
          <a
            href="{{ section.settings.button_link }}"
            class="countdown-timer__button"
            style="
              --btn-bg: {{ section.settings.button_bg_color }};
              --btn-text: {{ section.settings.button_text_color }};
              --btn-radius: {{ section.settings.button_border_radius }}px;
            "
          >
            {{ section.settings.button_label }}
          </a>
        {%- endif -%}
      </div>

      <div class="countdown-timer__expired" style="display: none;">
        <p class="countdown-timer__expired-message">{{ section.settings.expired_message }}</p>
      </div>
    </countdown-timer-component>
  </div>
</div>

{% stylesheet %}
  .countdown-timer-section {
    background-color: var(--countdown-bg-color, var(--color-background));
    color: var(--countdown-text-color, var(--color-foreground));
    padding-block-start: var(--countdown-padding-top);
    padding-block-end: var(--countdown-padding-bottom);
  }

  .countdown-timer__wrapper {
    width: 100%;
  }

  .countdown-timer {
    display: block;
    width: 100%;
  }

  .countdown-timer__content {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    justify-content: center;
    gap: var(--countdown-content-gap);
    text-align: center;
  }

  /* Desktop Layout Variants */
  .countdown-timer--layout-horizontal .countdown-timer__content {
    flex-direction: row;
  }

  .countdown-timer--layout-vertical .countdown-timer__content {
    flex-direction: column;
  }

  .countdown-timer--layout-text-left .countdown-timer__content {
    flex-direction: row;
    justify-content: space-between;
  }

  .countdown-timer--layout-text-left .countdown-timer__text-content {
    text-align: left;
  }

  .countdown-timer--layout-text-right .countdown-timer__content {
    flex-direction: row-reverse;
    justify-content: space-between;
  }

  .countdown-timer--layout-text-right .countdown-timer__text-content {
    text-align: right;
  }

  .countdown-timer__text-content {
    display: flex;
    flex-direction: column;
    gap: 4px;
    text-align: center;
  }

  .countdown-timer__heading {
    margin: 0;
    font-weight: 700;
    letter-spacing: 0.05em;
    text-transform: uppercase;
    color: var(--countdown-text-color, var(--color-foreground));
    line-height: 1.2;
    font-size: var(--countdown-heading-size);
  }

  .countdown-timer__subheading {
    margin: 0;
    opacity: 0.9;
    color: var(--countdown-text-color, var(--color-foreground));
    line-height: 1.4;
    font-size: var(--countdown-subheading-size);
  }

  .countdown-timer__timer {
    display: flex;
    align-items: center;
    justify-content: center;
    flex-wrap: wrap;
    gap: var(--countdown-timer-gap);
  }

  .countdown-timer__unit {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2px;
    text-align: center;
  }

  .countdown-timer__number {
    font-weight: 700;
    font-variant-numeric: tabular-nums;
    color: var(--countdown-timer-text-color, var(--countdown-text-color, var(--color-foreground)));
    line-height: 1;
    font-size: var(--countdown-timer-number-size);
  }

  .countdown-timer__label {
    text-transform: capitalize;
    color: var(--countdown-timer-label-color, var(--countdown-text-color, var(--color-foreground)));
    opacity: 0.85;
    font-size: var(--countdown-timer-label-size);
  }

  .countdown-timer__separator {
    font-weight: 700;
    color: var(--countdown-separator-color, var(--countdown-text-color, var(--color-foreground)));
    margin-inline: 2px;
    opacity: 0.7;
    font-size: calc(var(--countdown-timer-number-size) * 0.75);
    align-self: flex-start;
    padding-top: 2px;
  }

  .countdown-timer__button {
    display: inline-block;
    padding: 12px 24px;
    background-color: var(--btn-bg, var(--color-button));
    color: var(--btn-text, var(--color-button-text));
    border-radius: var(--btn-radius, 4px);
    text-decoration: none;
    font-weight: 600;
    font-size: 0.875rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    transition: opacity 0.2s ease, transform 0.2s ease;
  }

  .countdown-timer__button:hover {
    opacity: 0.9;
    transform: translateY(-1px);
  }

  .countdown-timer__expired {
    text-align: center;
  }

  .countdown-timer__expired-message {
    font-size: 1.25rem;
    font-weight: 600;
    margin: 0;
  }

  /* Mobile Responsive Styles */
  @media screen and (max-width: 749px) {
    .countdown-timer-section {
      padding-block-start: var(--countdown-padding-top-mobile);
      padding-block-end: var(--countdown-padding-bottom-mobile);
    }

    .countdown-timer__content {
      gap: var(--countdown-content-gap-mobile);
    }

    /* Mobile Layout Variants */
    .countdown-timer--mobile-layout-horizontal .countdown-timer__content {
      flex-direction: row;
      flex-wrap: wrap;
    }

    .countdown-timer--mobile-layout-vertical .countdown-timer__content {
      flex-direction: column;
    }

    .countdown-timer--mobile-layout-stacked .countdown-timer__content {
      flex-direction: column;
    }

    .countdown-timer--mobile-layout-stacked .countdown-timer__text-content {
      text-align: center;
      order: 1;
    }

    .countdown-timer--mobile-layout-stacked .countdown-timer__timer {
      order: 2;
    }

    .countdown-timer--mobile-layout-stacked .countdown-timer__button {
      order: 3;
    }

    .countdown-timer--mobile-layout-timer-first .countdown-timer__content {
      flex-direction: column;
    }

    .countdown-timer--mobile-layout-timer-first .countdown-timer__text-content {
      text-align: center;
      order: 2;
    }

    .countdown-timer--mobile-layout-timer-first .countdown-timer__timer {
      order: 1;
    }

    .countdown-timer--mobile-layout-timer-first .countdown-timer__button {
      order: 3;
    }

    /* Reset text alignment for mobile layouts */
    .countdown-timer--mobile-layout-horizontal .countdown-timer__text-content,
    .countdown-timer--mobile-layout-vertical .countdown-timer__text-content,
    .countdown-timer--mobile-layout-stacked .countdown-timer__text-content,
    .countdown-timer--mobile-layout-timer-first .countdown-timer__text-content {
      text-align: center;
    }

    .countdown-timer__heading {
      font-size: var(--countdown-heading-size-mobile);
    }

    .countdown-timer__subheading {
      font-size: var(--countdown-subheading-size-mobile);
    }

    .countdown-timer__timer {
      gap: var(--countdown-timer-gap-mobile);
    }

    .countdown-timer__number {
      font-size: var(--countdown-timer-number-size-mobile);
    }

    .countdown-timer__label {
      font-size: var(--countdown-timer-label-size-mobile);
    }

    .countdown-timer__separator {
      font-size: calc(var(--countdown-timer-number-size-mobile) * 0.75);
      margin-inline: 0;
    }

    .countdown-timer__unit {
      gap: 3px;
    }

    .countdown-timer__button {
      padding: 10px 20px;
      font-size: 0.75rem;
    }
  }
{% endstylesheet %}

{% schema %}
{
  "name": "Countdown Timer",
  "tag": "section",
  "class": "countdown-timer-section-wrapper",
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "settings": [
    {
      "type": "header",
      "content": "Timer Settings"
    },
    {
      "type": "text",
      "id": "end_date",
      "label": "End Date",
      "info": "Format: YYYY-MM-DD (e.g., 2026-12-31)",
      "default": "2026-12-31"
    },
    {
      "type": "text",
      "id": "end_time",
      "label": "End Time",
      "info": "Format: HH:MM in 24-hour format (e.g., 23:59)",
      "default": "23:59"
    },
    {
      "type": "checkbox",
      "id": "show_days",
      "label": "Show Days",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_hours",
      "label": "Show Hours",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_minutes",
      "label": "Show Minutes",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_seconds",
      "label": "Show Seconds",
      "default": true
    },
    {
      "type": "header",
      "content": "Timer Labels"
    },
    {
      "type": "text",
      "id": "days_label",
      "label": "Days Label",
      "default": "Days"
    },
    {
      "type": "text",
      "id": "hours_label",
      "label": "Hours Label",
      "default": "Hrs"
    },
    {
      "type": "text",
      "id": "minutes_label",
      "label": "Minutes Label",
      "default": "Mins"
    },
    {
      "type": "text",
      "id": "seconds_label",
      "label": "Seconds Label",
      "default": "Secs"
    },
    {
      "type": "header",
      "content": "Timer Separator"
    },
    {
      "type": "checkbox",
      "id": "show_separator",
      "label": "Show Separator",
      "default": true
    },
    {
      "type": "select",
      "id": "separator_style",
      "label": "Separator Style",
      "options": [
        {
          "value": ":",
          "label": "Colon (:)"
        },
        {
          "value": ".",
          "label": "Dot (.)"
        },
        {
          "value": "|",
          "label": "Pipe (|)"
        },
        {
          "value": "/",
          "label": "Slash (/)"
        },
        {
          "value": "-",
          "label": "Dash (-)"
        }
      ],
      "default": "."
    },
    {
      "type": "header",
      "content": "Text Content"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "NEW YEAR, NEW YOU"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "Subheading",
      "default": "Shop Now and Get Up To 70% Off"
    },
    {
      "type": "header",
      "content": "Button"
    },
    {
      "type": "text",
      "id": "button_label",
      "label": "Button Label",
      "info": "Leave blank to hide button"
    },
    {
      "type": "url",
      "id": "button_link",
      "label": "Button Link"
    },
    {
      "type": "color",
      "id": "button_bg_color",
      "label": "Button Background Color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Button Text Color",
      "default": "#006241"
    },
    {
      "type": "range",
      "id": "button_border_radius",
      "label": "Button Border Radius",
      "min": 0,
      "max": 30,
      "step": 1,
      "default": 4,
      "unit": "px"
    },
    {
      "type": "header",
      "content": "Expiration Settings"
    },
    {
      "type": "select",
      "id": "expiration_action",
      "label": "When Timer Ends",
      "options": [
        {
          "value": "message",
          "label": "Show expired message"
        },
        {
          "value": "hide",
          "label": "Hide the section"
        },
        {
          "value": "restart",
          "label": "Restart the timer"
        }
      ],
      "default": "message"
    },
    {
      "type": "text",
      "id": "expired_message",
      "label": "Expired Message",
      "default": "This offer has ended",
      "info": "Only used when 'Show expired message' is selected"
    },
    {
      "type": "checkbox",
      "id": "hide_when_expired",
      "label": "Hide Section When Expired",
      "default": false
    },
    {
      "type": "header",
      "content": "Restart Timer Settings",
      "info": "Set the duration for the timer to restart. Only used when 'Restart the timer' is selected."
    },
    {
      "type": "checkbox",
      "id": "restart_enabled",
      "label": "Enable Timer Restart",
      "default": false,
      "info": "Timer will loop continuously with the duration below"
    },
    {
      "type": "range",
      "id": "restart_days",
      "label": "Restart Every - Days",
      "min": 0,
      "max": 30,
      "step": 1,
      "default": 1,
      "unit": "d"
    },
    {
      "type": "range",
      "id": "restart_hours",
      "label": "Restart Every - Hours",
      "min": 0,
      "max": 23,
      "step": 1,
      "default": 0,
      "unit": "h"
    },
    {
      "type": "range",
      "id": "restart_minutes",
      "label": "Restart Every - Minutes",
      "min": 0,
      "max": 59,
      "step": 1,
      "default": 0,
      "unit": "m"
    },
    {
      "type": "range",
      "id": "restart_seconds",
      "label": "Restart Every - Seconds",
      "min": 0,
      "max": 59,
      "step": 1,
      "default": 0,
      "unit": "s"
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color Scheme",
      "default": "scheme-1"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color",
      "default": "#006241"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "accent_color",
      "label": "Accent Color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "timer_text_color",
      "label": "Timer Numbers Color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "timer_label_color",
      "label": "Timer Labels Color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "separator_color",
      "label": "Separator Color",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "━━━ Desktop Settings ━━━"
    },
    {
      "type": "select",
      "id": "desktop_layout",
      "label": "Desktop Layout",
      "options": [
        {
          "value": "horizontal",
          "label": "Horizontal (side by side)"
        },
        {
          "value": "vertical",
          "label": "Vertical (stacked)"
        },
        {
          "value": "text-left",
          "label": "Text Left, Timer Right"
        },
        {
          "value": "text-right",
          "label": "Text Right, Timer Left"
        }
      ],
      "default": "horizontal"
    },
    {
      "type": "select",
      "id": "section_width",
      "label": "Section Width",
      "options": [
        {
          "value": "page-width",
          "label": "Page Width"
        },
        {
          "value": "full-width",
          "label": "Full Width"
        }
      ],
      "default": "full-width"
    },
    {
      "type": "range",
      "id": "heading_size",
      "label": "Heading Size",
      "min": 12,
      "max": 48,
      "step": 1,
      "default": 20,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "subheading_size",
      "label": "Subheading Size",
      "min": 10,
      "max": 24,
      "step": 1,
      "default": 14,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "timer_number_size",
      "label": "Timer Number Size",
      "min": 16,
      "max": 72,
      "step": 1,
      "default": 32,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "timer_label_size",
      "label": "Timer Label Size",
      "min": 8,
      "max": 24,
      "step": 1,
      "default": 14,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "timer_gap",
      "label": "Gap Between Timer Units",
      "min": 4,
      "max": 40,
      "step": 2,
      "default": 12,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "content_gap",
      "label": "Gap Between Content Sections",
      "min": 8,
      "max": 80,
      "step": 4,
      "default": 40,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "padding_top",
      "label": "Top Padding",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 15
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "Bottom Padding",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 15
    },
    {
      "type": "header",
      "content": "━━━ Mobile Settings ━━━"
    },
    {
      "type": "select",
      "id": "mobile_layout",
      "label": "Mobile Layout",
      "options": [
        {
          "value": "horizontal",
          "label": "Horizontal (side by side)"
        },
        {
          "value": "vertical",
          "label": "Vertical"
        },
        {
          "value": "stacked",
          "label": "Stacked (Text on top)"
        },
        {
          "value": "timer-first",
          "label": "Timer First (Timer on top)"
        }
      ],
      "default": "stacked"
    },
    {
      "type": "range",
      "id": "mobile_heading_size",
      "label": "Mobile Heading Size",
      "min": 10,
      "max": 36,
      "step": 1,
      "default": 16,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "mobile_subheading_size",
      "label": "Mobile Subheading Size",
      "min": 8,
      "max": 20,
      "step": 1,
      "default": 11,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "mobile_timer_number_size",
      "label": "Mobile Timer Number Size",
      "min": 12,
      "max": 48,
      "step": 1,
      "default": 24,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "mobile_timer_label_size",
      "label": "Mobile Timer Label Size",
      "min": 6,
      "max": 18,
      "step": 1,
      "default": 10,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "mobile_timer_gap",
      "label": "Mobile Gap Between Timer Units",
      "min": 2,
      "max": 24,
      "step": 1,
      "default": 8,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "mobile_content_gap",
      "label": "Mobile Gap Between Content Sections",
      "min": 4,
      "max": 40,
      "step": 2,
      "default": 12,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "mobile_padding_top",
      "label": "Mobile Top Padding",
      "min": 0,
      "max": 60,
      "step": 1,
      "unit": "px",
      "default": 10
    },
    {
      "type": "range",
      "id": "mobile_padding_bottom",
      "label": "Mobile Bottom Padding",
      "min": 0,
      "max": 60,
      "step": 1,
      "unit": "px",
      "default": 10
    }
  ],
  "presets": [
    {
      "name": "Countdown Timer",
      "category": "Promotional",
      "settings": {
        "heading": "NEW YEAR, NEW YOU",
        "subheading": "Shop Now and Get Up To 70% Off",
        "end_date": "2026-12-31",
        "end_time": "23:59",
        "show_days": false,
        "show_hours": true,
        "show_minutes": true,
        "show_seconds": true,
        "background_color": "#006241",
        "text_color": "#ffffff",
        "desktop_layout": "horizontal",
        "mobile_layout": "stacked"
      }
    }
  ]
}
{% endschema %}
